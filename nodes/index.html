<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebAssembly</title>
</head>
<body style="background-color: black">
<canvas id="canvas"></canvas>
<script src="../wasm_exec.js"></script>
<script>
  const go = new Go()
  WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
    go.run(result.instance)
    main()
  })

  async function main() {
    let canvas = document.getElementById("canvas")
    let ctx = canvas.getContext('2d')
    let dpr = window.devicePixelRatio
    let width = window.innerWidth - 15
    let height = window.innerHeight - 15
    let nPoints = 400
    let bounceBounds = true
    canvas.width = width * dpr
    canvas.height = height * dpr
    canvas.style.width = `${width}px`
    canvas.style.height = `${height}px`
    ctx.scale(dpr, dpr)
    ctx.fillStyle = `rgb(0, 167, 167)`
    ctx.strokeStyle = `rgba(0, 255, 255, .85)`
    init(width, height, nPoints, bounceBounds)
    let points

    let draw = function () {
      ctx.clearRect(0, 0, width, height)
      points = getPoints()
      ctx.beginPath()
      for (let i = 0; i < nPoints; i++) {
        let p = points[i]
        ctx.arc(p.x, p.y, 4, 0, Math.PI * 2)
        ctx.closePath()
      }
      ctx.fill()
      updatePoints()
      window.requestAnimationFrame(draw)
    }
    window.requestAnimationFrame(draw)

  }
</script>
</body>
</html>